<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <style>
        svg {
            background-color: #57595D;
}}
    </style>
</head>
 
<svg></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<body>
<script>


// append the svg object to the body of the page
var svg = d3.select("svg")
    .attr("width", $(window).innerWidth() - 25)
    .attr("height", $(window).innerHeight() - 25);
//add encompassing group for the zoom 
var g = svg.append("g")
    .attr("class", "everything");
//add zoom capabilities 
var zoom_handler = d3.zoom()
    .on("zoom", zoom_actions);

zoom_handler(svg);     

function zoom_actions(){
    g.attr("transform", d3.event.transform)
}

  /*

.call(d3.zoom()
.scaleExtent([1 / 2, 4]).on("zoom", function () {
    svg.attr("transform", d3.event.transform)
  }))
  .append("g");
*/

function box_force() { 
  for (var i = 0, n = nodes.length; i < n; ++i) {
    curr_node = nodes[i];
    curr_node.x = Math.max(10, Math.min(width - 10, curr_node.x));
    curr_node.y = Math.max(10, Math.min(height - 10, curr_node.y));
  }
}

var width = svg.attr("width")
var height = svg.attr("height")

  
// load edges  
var edges = {{ edges|safe }}

// load nodes
var nodes = {{ nodes|safe }}
nodes.forEach(function(d) { 
                            if (d.type == 'pessoa') {d.id = d.info.cpid, d.text = d.info.iniciais}
                            else if (d.type == 'partido') {d.id = d.info.value,  d.text = d.info.value}
                            else if (d.type == 'profissao') {d.id = d.info.value, d.text = d.info.value}
                            else if (d.type == 'comissoes_parlamentares_a_que_pertence') {d.id = d.info.value, d.text = d.info.value}
                            else if (d.type == 'data_de_nascimento') {d.id = d.info.value, d.text = d.info.value}
                            })
// set up simulation
var simulation = d3.forceSimulation()
    .nodes(nodes)
    .force("link", d3.forceLink(edges).id(function(d) { return d.id; }))
    .force("charge", d3.forceManyBody().strength(-400))
    .force("center", d3.forceCenter(width / 2, height / 2))
    //.force("box_force", box_force)
    .on("tick", ticked);
// draw edge lones
var link = g.append("g")
    .selectAll("line")
    .data(edges)
    .enter().append("line")
    .style("stroke", "#aaa")
    .attr("stroke-width", 0.2);

var node = g.append("g")
    .selectAll("g")
    .data(nodes)
    .enter().append("g")
    
    

        

    
var circles = node.filter(
                function(d){
                        return d.type == 'pessoa' || d.type == 'partido' || d.type == 'profissao' || d.type == 'data_de_nascimento';})
    .append("circle")
    .attr("r", function(d) {      
     d.weight = link.filter(function(l) {
       return l.source.index == d.index || l.target.index == d.index
     }).size();      
     var minRadius = 1;
     return minRadius + (d.weight);
   })
    .attr("fill", function(d) { 
                                    if (d.type == 'pessoa') {return "#eacfac"}

                                    else if (d.text == 'PS') {return "#f43674"}
                                    else if (d.text == 'PSD') {return "#f48b30"}
                                    else if (d.text == 'CH') {return "#2e3853"}
                                    else if (d.text == 'BE') {return "#0b0b0b"}
                                    else if (d.text == 'CDU') {return "#003e89"}
                                    else if (d.text == 'IL') {return "#22c2fe"}
                                    else if (d.text == 'PEV') {return "#666666"}
                                    else if (d.text == 'PCP') {return "#222"}
                                    else if (d.text == 'PAN') {return "#29c1ac"}
                                    else if (d.text == 'CDS-PP') {return "#1793d1"}

                                    else if (d.type == 'profissao') {return "#504048"}
                                    
                                    else if (d.type == 'data_de_nascimento')  {return "#be6043"};
                                    })
    
var squares = node
    .filter(
        function(d){return d.type == 'comissoes_parlamentares_a_que_pertence'})
    .append('rect')
    .attr('width', 10)
    .attr('height', 10)
    .attr('fill', '#623122');

var labels = node.append("text")
    .text(function(d) { return d.text;})
    .attr('x', 6)
    .attr('y', 3)
    .style("font-size", function(d) { return d.weight;})
        

drag_handler = d3.drag()
    .on("start", dragstarted)
    .on("drag", dragged)
    .on("end", dragended);

drag_handler(node)

  

function dragstarted(d) {
    if (!d3.event.active) simulation.alphaTarget(0.3).restart();
    d.fx = d.x;
    d.fy = d.y;
}

function dragged(d) {
    d.fx = d3.event.x;
    d.fy = d3.event.y;
}

function dragended(d) {
    if (!d3.event.active) simulation.alphaTarget(0);
    d.fx = d.x;
    d.fy = d.y;
}




function ticked() {


node
    .attr("transform", function(d) {
      return "translate(" + d.x + "," + d.y + ")";
    })
link
    .attr("x1", function(d) { return d.source.x; })
    .attr("y1", function(d) { return d.source.y; })
    .attr("x2", function(d) { return d.target.x; })
    .attr("y2", function(d) { return d.target.y; });

}


</script>

</body>